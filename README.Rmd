---
output: github_document
bibliography: vignettes/references.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# A Toolkit for Nested Sampling

```{r srr, eval = FALSE, echo = FALSE}
#' SRR STATS BLOCK
#' 
#' @srrstats {G1.0, G1.1} Contains primary references and list of previous NS softwares. Also states that ernest is the first R package providing a toolkit for implementing NS.
#' @srrstats {BS1.2, BS1.2a} Introduces how priors are specified within ernest.
```

<!-- badges: start -->

[![R-CMD-check](https://github.com/kylesnap/ernest/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/kylesnap/ernest/actions/workflows/R-CMD-check.yaml) [![codecov](https://codecov.io/gh/kylesnap/ernest/branch/ropensci_submission/graph/badge.svg?token=6HL8L046Y7)](https://codecov.io/gh/kylesnap/ernest)

<!-- badges: end -->

ernest is a comprehensive toolkit for nested sampling (NS) in R, enabling estimation of Bayesian evidence and posterior distributions for statistical models. Alongside an original R-based implementation of the algorithm described by @skilling2006, ernest provides:

1.  S3 objects and methods for defining model likelihoods and prior parameter distributions;
2.  Methods for simulating, reporting, and visualising uncertainty in NS estimates;
3.  S3 generics for developers to implement custom likelihood-restricted prior samplers.

ernest's API is inspired by the Python package nestle [@barbary2015], which also influenced dynesty [@speagle2020].

## Installation

Install the development version of ernest from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("kylesnap/ernest")
```

## Nested Sampling in a Nutshell

Nested sampling (NS) is a Bayesian algorithm for evaluating model plausibility, measured as the *Bayesian evidence* or *marginal likelihood* ($\mathcal{Z}$). The evidence normalises the posterior distribution; by reorganising Bayes' theorem, we see that $\mathcal{Z}$ is the probability of the observed data across all possible parameter values $\theta$: $$
\mathcal{Z} = \int_{\forall \theta} L(\theta) \pi(\theta) d\theta
$$ For most models, this integral cannot be solved analytically. NS addresses this by dividing the prior space $\pi(\theta)$ into a nested sequence of small volumes, sorted by likelihood, to form a one-dimensional approximation of the evidence integral. NS offers several advantages over other Bayesian methods such as Markov chain Monte Carlo (MCMC):

1.  NS performs a global exploration of $\pi(\theta)$;
2.  NS is robust to distributions that are poorly-conditioned (e.g., multiple modes or discontinuities);
3.  NS can simultaneously estimate a model's evidence and its posterior distribution, and;
4.  NS provides natural stopping criteriaâ€”no need for burn-in or manual convergence checks.

## Nested Sampling in Ernest

ernest provides a native R and C++11 implementation of nested sampling, with an API designed for R users.

To begin, specify a likelihood function and a prior space. For example:

``` r
library(ernest)
library(LaplacesDemon)

# Uniform prior over [-10, 10) for three parameters
prior <- create_uniform_prior(
  3,
  lower = -10,
  upper = 10,
  varnames = c("x", "y", "z")
)

# Multivariate normal log-likelihood
mu <- c(0, 0, 0)
C <- diag(1, 3)
C[C == 0] <- 0.95
loglike <- create_likelihood(
  rowwise_fn = dmvn,
  mu = !!mu,
  Sigma = !!C,
  log = TRUE
)

# Set up and run the sampler
sampler <- ernest_sampler(
  log_lik = loglike,
  prior = prior,
  n_points = 500
)
run <- generate(sampler, max_iterations = 2000, seed = 123)

# Summarise and visualise results
summary(run)
plot(run)
visualize(run, type = "density")
```

For advanced usage, including custom priors and hierarchical models, see the package vignette.

## Prior Art

Below are selected packages that implement NS, in addition to nestle and dynesty:

| Package | Author | Languages |
|:---------------------|:--------------------:|:---------------------------:|
| [polychord](https://github.com/PolyChord/PolyChordLite) | Will Handley, Mike Hobson, & Anthony Lasenby | Fortran, with Python and C/C++ interfaces |
| [MultiNest](https://github.com/JohannesBuchner/MultiNest) | Farhan Feroz & Mike Hobson | Fortran, with R, Python, and C++ interfaces |
| [perfectns](https://github.com/ejhigson/perfectns) | Edward Higson | Python |

In addition, the nestcheck Python package provides routines for diagnosing nested sampling runs [@anesthetic].

### References
