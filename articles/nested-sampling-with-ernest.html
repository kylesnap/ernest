<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quickstart: Nested Sampling with Ernest • ernest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quickstart: Nested Sampling with Ernest">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ernest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/more-ernest-runs.html">More Ernest Runs</a></li>
    <li><a class="dropdown-item" href="../articles/nested-sampling-with-ernest.html">Quickstart: Nested Sampling with Ernest</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kylesnap/ernest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quickstart: Nested Sampling with Ernest</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kylesnap/ernest/blob/ropensci_submission/vignettes/nested-sampling-with-ernest.Rmd" class="external-link"><code>vignettes/nested-sampling-with-ernest.Rmd</code></a></small>
      <div class="d-none name"><code>nested-sampling-with-ernest.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kylesnap.github.io/ernest/">ernest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/olafmersmann/truncnorm" class="external-link">truncnorm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LaplacesDemonR/LaplacesDemon" class="external-link">LaplacesDemon</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="nested-sampling-with-ernest">Nested Sampling with Ernest<a class="anchor" aria-label="anchor" href="#nested-sampling-with-ernest"></a>
</h2>
<p>This vignette provides a hands-on introduction to nested sampling
using the <code>ernest</code> package. You will learn how to:</p>
<ul>
<li>Understand the role of model evidence in Bayesian inference and why
it is difficult to compute.</li>
<li>Use prior transforms to define parameter spaces for nested
sampling.</li>
<li>Set up and run a nested sampling analysis in R with ernest.</li>
<li>Inspect, summarise, and visualise results, including evidence and
posterior samples.</li>
</ul>
<div class="section level3">
<h3 id="bayesian-model-evidence-and-nested-sampling">Bayesian Model Evidence and Nested Sampling<a class="anchor" aria-label="anchor" href="#bayesian-model-evidence-and-nested-sampling"></a>
</h3>
<p>In Bayesian inference, we use probabilities to represent our current
beliefs about a model’s unobservable parameters. When we gather new
data, we update these beliefs using Bayes’ theorem:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>Z</mi></mfrac></mrow><annotation encoding="application/x-tex">
P(\theta) = \frac{L(\theta)\pi(\theta)}{Z}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\theta)</annotation></semantics></math>
is the <em>prior distribution</em>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">L(\theta)</annotation></semantics></math>
is the <em>likelihood</em> of a model given parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
and the data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(\theta)</annotation></semantics></math>
is the <em>posterior distribution</em> of the parameters after our
beliefs have been updated.</p>
<p>The denominator
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
is called the <em>Bayesian evidence</em> or <em>marginal
likelihood</em>. In isolation,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
serves to normalise
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(\theta)</annotation></semantics></math>
so that it is a well-conditioned probability distribution. If we
reorganise Bayes’ theorem to isolate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>,
we see that calculating a model’s evidence involves integrating over all
possible values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><msub><mo>∫</mo><mrow><mo>∀</mo><mi>θ</mi></mrow></msub><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>θ</mi></mrow><annotation encoding="application/x-tex">
Z = \int_{\forall \theta} L(\theta) \pi(\theta) d\theta
</annotation></semantics></math> This allows us to use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
as a parameter-independent measure of a model’s overall plausibility
given some data. When comparing two models, the ratio of their
respective evidences (called the <a href="https://en.wikipedia.org/wiki/Bayes_factor" class="external-link">Bayes factor</a>)
shows how much more the data support one model over the other, which
forms the foundation of Bayesian model selection.</p>
<p>For most data and models, the evidence integral cannot be solved
directly. Instead, researchers rely on estimation methods. Nested
sampling (NS), introduced by <span class="citation">Skilling
(2006)</span>, is designed to estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
even when the posterior distribution is poorly conditioned (e.g., if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">L(\theta)</annotation></semantics></math>
has multiple peaks or discontinuities along values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>).
It accomplishes this by dividing the prior space
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\theta)</annotation></semantics></math>
into many small nested shells or volumes. These shells are defined by
the smallest likelihood value they contain, such that the volume of the
cells containing the smallest value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>L</mi><mo>*</mo></msup><annotation encoding="application/x-tex">L^*</annotation></semantics></math>
is given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>L</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mo>∫</mo><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msup><mi>L</mi><mo>*</mo></msup></mrow></msub><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>θ</mi></mrow><annotation encoding="application/x-tex">
V(L^*) = \int_{L(\theta) &gt; L^*} \pi(\theta) d\theta
</annotation></semantics></math> If we build many
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>L</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(L^*)</annotation></semantics></math>
across different values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>L</mi><mo>*</mo></msup><annotation encoding="application/x-tex">L^*</annotation></semantics></math>,
we can approximate the original multidimensional integral across the
parameter space of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
with a one-dimensional integral over the sequence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>L</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(L^*)</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mn>1</mn></msubsup><msup><mi>V</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>L</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>V</mi></mrow><annotation encoding="application/x-tex">
Z = \int_0^1 V^{-1}(L^*) dV
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>V</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>L</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>L</mi><mo>*</mo></msup></mrow><annotation encoding="application/x-tex">V^{-1}(V(L^*)) = L^*</annotation></semantics></math>
exists. This requires us to estimate the volume of each shell
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>V</mi><annotation encoding="application/x-tex">V</annotation></semantics></math>,
which we can do <span class="citation">(Speagle 2020)</span>.</p>
<p>NS generates this sequence of shells by generating a set number of
live points within the prior space, then replacing the worst of these
points with a new point from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\theta)</annotation></semantics></math>
with an additional likelihood constraint. This lets NS handle
complicated likelihood surfaces, including those with multiple peaks or
sharp transitions. In addition, NS naturally provides stopping rules,
meaning the algorithm knows when it has gathered enough information to
accurately estimate the evidence. As a bonus, the same samples used for
evidence estimation can be repurposed to estimate the posterior
distribution.</p>
</div>
<div class="section level3">
<h3 id="nested-sampling-with-ernest-1">Nested Sampling with ernest<a class="anchor" aria-label="anchor" href="#nested-sampling-with-ernest-1"></a>
</h3>
<p>Here, we use an example from the <a href="https://dynesty.readthedocs.io/en/v2.1.5/crashcourse.html" class="external-link">dynesty</a>
documentation to demonstrate how to use ernest to design, perform, and
report nested sampling runs.</p>
<div class="section level4">
<h4 id="defining-priors">Defining Priors<a class="anchor" aria-label="anchor" href="#defining-priors"></a>
</h4>
<p>Nested sampling operates by drawing samples from the prior, but for
efficiency, ernest represents the prior space as points in a [0, 1)-unit
hypercube. A <em>prior transformation</em> function must be specified to
translate points from the hypercube into valid
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>.</p>
<p>In ernest, you define priors using functions like
<code><a href="../reference/create_uniform_prior.html">create_uniform_prior()</a></code> or by supplying a custom
transformation to <code><a href="../reference/create_prior.html">create_prior()</a></code>. In addition to organising
the prior into an object that ernest can use during NS, these functions
also perform checks to help ensure your prior transformation function is
size- and type-stable.</p>
<div class="section level5">
<h5 id="example-uniform-prior">Example: Uniform Prior<a class="anchor" aria-label="anchor" href="#example-uniform-prior"></a>
</h5>
<p>In many cases, it is sufficient to define a prior with independently
distributed uniform or normal distributions. Ernest provides convenience
functions to build such priors with efficient prior transformation
functions.</p>
<p>The following defines a uniform prior over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">[</mo><mo>−</mo><mn>10</mn><mo>,</mo><mn>10</mn><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">[-10, 10)</annotation></semantics></math>
for each parameter in 3D space:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_uniform_prior.html">create_uniform_prior</a></span><span class="op">(</span></span>
<span>  lower <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>,</span>
<span>  upper <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">prior</span></span>
<span><span class="co">#&gt; Prior distribution <span style="color: #0000BB;">&lt;uniform_prior/ernest_prior&gt;</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Names: <span style="color: #0000BB;">"x"</span>, <span style="color: #0000BB;">"y"</span>, and <span style="color: #0000BB;">"z"</span></span></span>
<span><span class="co">#&gt; Bounds:</span></span>
<span><span class="co">#&gt; → Lower: -10, -10, and -10</span></span>
<span><span class="co">#&gt; → Upper: 10, 10, and 10</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="example-customconditional-prior">Example: Custom/Conditional Prior<a class="anchor" aria-label="anchor" href="#example-customconditional-prior"></a>
</h5>
<p>For more complex priors, you must provide a custom function. In the
case of prior spaces with independent marginals, this amounts to
specifying a function that applies the inverse CDF for each component of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>.</p>
<p>Consider the following prior space with five dimensions: The first
two are drawn from a bivariate Normal distribution, the third is drawn
from a Beta distribution, the fourth from a Gamma distribution, and the
fifth from a truncated normal distribution.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">five_dim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="co"># MVN(mu = c(5, 2), Sigma = [5, 4; 4, 5])</span></span>
<span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">u</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sigma_sqrt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">t</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">sigma_sqrt</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Beta</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">qbeta</a></span><span class="op">(</span><span class="va">u</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, shape1 <span class="op">=</span> <span class="fl">2.31</span>, shape2 <span class="op">=</span> <span class="fl">0.627</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Gamma</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">qgamma</a></span><span class="op">(</span><span class="va">u</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, shape <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Truncated Normal</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/truncnorm/man/dtruncnorm.html" class="external-link">qtruncnorm</a></span><span class="op">(</span><span class="va">u</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, a <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/create_prior.html">create_prior</a></span><span class="op">(</span></span>
<span>  fn <span class="op">=</span> <span class="va">five_dim</span>,</span>
<span>  .n_dim <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  .varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MVN"</span>, <span class="st">"MVN"</span>, <span class="st">"Beta"</span>, <span class="st">"Gamma"</span>, <span class="st">"Norm[2, 10]"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; New names:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `MVN` -&gt; `MVN...1`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `MVN` -&gt; `MVN...2`</span></span>
<span><span class="co">#&gt; Prior distribution <span style="color: #0000BB;">&lt;ernest_prior&gt;</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Names: <span style="color: #0000BB;">"MVN...1"</span>, <span style="color: #0000BB;">"MVN...2"</span>, <span style="color: #0000BB;">"Beta"</span>, <span style="color: #0000BB;">"Gamma"</span>, and <span style="color: #0000BB;">"Norm[2, 10]"</span></span></span></code></pre></div>
<p>For more sophisticated priors (such as those for hierarchical
models), you will need to build more involved prior transformation
functions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hierarchical</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># mu ~ N(5, 1)</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">u</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># log10(sd) ~ U[-1, 1]</span></span>
<span>  <span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">qunif</a></span><span class="op">(</span><span class="va">u</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># x ~ N(mu, sd^2)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">u</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, mean <span class="op">=</span> <span class="va">mu</span>, sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sd</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/create_prior.html">create_prior</a></span><span class="op">(</span></span>
<span>  fn <span class="op">=</span> <span class="va">hierarchical</span>,</span>
<span>  .n_dim <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  .varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"sigma"</span>, <span class="st">"x"</span><span class="op">)</span>,</span>
<span>  .lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">0</span>, <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Prior distribution <span style="color: #0000BB;">&lt;ernest_prior&gt;</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Names: <span style="color: #0000BB;">"mu"</span>, <span style="color: #0000BB;">"sigma"</span>, and <span style="color: #0000BB;">"x"</span></span></span>
<span><span class="co">#&gt; Bounds:</span></span>
<span><span class="co">#&gt; → Lower: -Inf, 0, and -Inf</span></span>
<span><span class="co">#&gt; → Upper: Inf, Inf, and Inf</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="likelihood-function">Likelihood Function<a class="anchor" aria-label="anchor" href="#likelihood-function"></a>
</h4>
<p>Model log-likelihoods are represented by R functions. These functions
are expected to return a single scalar value for each possible
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
within the prior space. If, for any reason,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\theta)</annotation></semantics></math>
contains regions where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
is invalid, ensure your likelihood function returns
<code>-Inf</code>.</p>
<p>In this example, we use <code><a href="../reference/create_likelihood.html">create_likelihood()</a></code> to assign
parameters to the <code>LaplaceDemon</code> density function for a
multivariate normal distribution:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">C</span><span class="op">[</span><span class="va">C</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.95</span></span>
<span></span>
<span><span class="va">loglike</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_likelihood.html">create_likelihood</a></span><span class="op">(</span></span>
<span>  rowwise_fn <span class="op">=</span> <span class="va">dmvn</span>,</span>
<span>  mu <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">mu</span>,</span>
<span>  Sigma <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">C</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="setting-up-and-running-the-sampler">Setting Up and Running the Sampler<a class="anchor" aria-label="anchor" href="#setting-up-and-running-the-sampler"></a>
</h4>
<p>Initialise the sampler with your likelihood and prior. The number of
live points (<code>n_points</code>) controls the resolution (more points
= higher accuracy, slower run).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampler</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ernest_sampler.html">ernest_sampler</a></span><span class="op">(</span></span>
<span>  log_lik <span class="op">=</span> <span class="va">loglike</span>,</span>
<span>  prior <span class="op">=</span> <span class="va">prior</span>,</span>
<span>  n_points <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sampler</span></span>
<span><span class="co">#&gt; Nested sampling specification <span style="color: #0000BB;">&lt;ernest_sampler&gt;</span></span></span>
<span><span class="co">#&gt; No. Points: 500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Sampling Method </span></span>
<span><span class="co">#&gt; • Random Walk in Unit Cube LRPS <span style="color: #0000BB;">&lt;rwmh_cube/ernest_lrps&gt;</span></span></span>
<span><span class="co">#&gt; • No. Dimensions: 3</span></span>
<span><span class="co">#&gt; • No. Calls Since Update: 0</span></span>
<span><span class="co">#&gt; • No. Accepted Since Update: 0</span></span>
<span><span class="co">#&gt; • Current Step Size: 1</span></span></code></pre></div>
<p>Run nested sampling for a fixed number of iterations or until the
evidence estimate converges:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/generate.html" class="external-link">generate</a></span><span class="op">(</span><span class="va">sampler</span>, max_iterations <span class="op">=</span> <span class="fl">2000</span>, seed <span class="op">=</span> <span class="fl">123</span>, show_progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Creating new live points.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> `max_iterations` reached (2000).</span></span>
<span><span class="va">run</span></span>
<span><span class="co">#&gt; Nested sampling run <span style="color: #0000BB;">&lt;ernest_run/ernest_sampler&gt;</span></span></span>
<span><span class="co">#&gt; No. Points: 500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Sampling Method </span></span>
<span><span class="co">#&gt; • Random Walk in Unit Cube LRPS <span style="color: #0000BB;">&lt;rwmh_cube/ernest_lrps&gt;</span></span></span>
<span><span class="co">#&gt; • No. Dimensions: 3</span></span>
<span><span class="co">#&gt; • No. Calls Since Update: 0</span></span>
<span><span class="co">#&gt; • No. Accepted Since Update: 0</span></span>
<span><span class="co">#&gt; • Current Step Size: 0.0811</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Results </span></span>
<span><span class="co">#&gt; No. Iterations: 2000</span></span>
<span><span class="co">#&gt; No. Calls: 35651</span></span>
<span><span class="co">#&gt; Log. Evidence: -9.3077 (± 1.7635)</span></span></code></pre></div>
<p><code>generate</code> produces an <code>ernest_run</code> object that
can be saved to disk. You can continue a run by calling
<code>generate</code> on a previously created
<code>ernest_run</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"ernest_run.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">run</span>, <span class="va">tmp_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">continued_run</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">run2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/generate.html" class="external-link">generate</a></span><span class="op">(</span><span class="va">continued_run</span>, min_logz <span class="op">=</span> <span class="fl">0.01</span>, show_progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Restoring live points from a previous run.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> `min_logz` reached (0.01 &lt; 0.01).</span></span>
<span><span class="va">run2</span></span>
<span><span class="co">#&gt; Nested sampling run <span style="color: #0000BB;">&lt;ernest_run/ernest_sampler&gt;</span></span></span>
<span><span class="co">#&gt; No. Points: 500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Sampling Method </span></span>
<span><span class="co">#&gt; • Random Walk in Unit Cube LRPS <span style="color: #0000BB;">&lt;rwmh_cube/ernest_lrps&gt;</span></span></span>
<span><span class="co">#&gt; • No. Dimensions: 3</span></span>
<span><span class="co">#&gt; • No. Calls Since Update: 0</span></span>
<span><span class="co">#&gt; • No. Accepted Since Update: 0</span></span>
<span><span class="co">#&gt; • Current Step Size: 0.004</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Results </span></span>
<span><span class="co">#&gt; No. Iterations: 6716</span></span>
<span><span class="co">#&gt; No. Calls: 153551</span></span>
<span><span class="co">#&gt; Log. Evidence: -9.1101 (± 0.1254)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="inspecting-and-summarising-results">Inspecting and Summarising Results<a class="anchor" aria-label="anchor" href="#inspecting-and-summarising-results"></a>
</h4>
<p>The result object has a <code>summary</code> method for viewing
evidence estimates, posterior samples, and diagnostics as a tidy
<code>tibble</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">run2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Nested sampling results </span><span style="color: #0000BB; font-weight: bold;">&lt;ernest_run&gt;</span> <span style="color: #00BBBB;">────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; No. Points: 500</span></span>
<span><span class="co">#&gt; No. Iterations: 6716</span></span>
<span><span class="co">#&gt; No. Lik. Calls: 153551</span></span>
<span><span class="co">#&gt; Log. Evidence: -9.1101 (± 0.1254)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">run2</span><span class="op">)</span><span class="op">$</span><span class="va">run</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,216 × 7</span></span></span>
<span><span class="co">#&gt;     call log_lik log_volume log_weight log_evidence log_evidence_err information</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">650.</span>     -<span style="color: #BB0000;">0.002</span>     -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">647.</span>       -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">656.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">278.</span>     -<span style="color: #BB0000;">0.004</span>     -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">275.</span>       -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">284.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">233.</span>     -<span style="color: #BB0000;">0.006</span>     -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">230.</span>       -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">239.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">013.</span>     -<span style="color: #BB0000;">0.008</span>     -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">011.</span>       -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">020.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">008.</span>     -<span style="color: #BB0000;">0.01</span>      -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">006.</span>       -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">015.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">968.</span>     -<span style="color: #BB0000;">0.012</span>     -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">965.</span>       -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">975.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">927.</span>     -<span style="color: #BB0000;">0.014</span>     -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">924.</span>       -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">933.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">905.</span>     -<span style="color: #BB0000;">0.016</span>     -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">902.</span>       -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">911.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">871.</span>     -<span style="color: #BB0000;">0.018</span>     -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">868.</span>       -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">877.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">832.</span>     -<span style="color: #BB0000;">0.02</span>      -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">829.</span>       -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">838.</span>                0           0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,206 more rows</span></span></span></code></pre></div>
<p>The <code>posterior</code> package offers methods for inspecting the
points generated during a run.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span>
<span><span class="va">unweighted_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws.html" class="external-link">as_draws</a></span><span class="op">(</span><span class="va">run2</span><span class="op">)</span></span></code></pre></div>
<p>You can view the importance weight of each point and reweight the
sample to estimate the posterior distribution:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">unweighted_post</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 0 0</span></span>
<span><span class="va">weighted_post</span> <span class="op">&lt;-</span> <span class="va">unweighted_post</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mc-stan.org/posterior/reference/resample_draws.html" class="external-link">resample_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarise_draws</a></span><span class="op">(</span><span class="va">weighted_post</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 10</span></span></span>
<span><span class="co">#&gt;   variable   mean   median    sd   mad    q5   q95  rhat ess_bulk ess_tail</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> x        0.025<span style="text-decoration: underline;">2</span>  0.017<span style="text-decoration: underline;">8</span>  0.958 0.957 -<span style="color: #BB0000;">1.51</span>  1.61  1.16    <span style="text-decoration: underline;">2</span>268.     14.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> y        0.018<span style="text-decoration: underline;">6</span> -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">64</span> 0.961 0.938 -<span style="color: #BB0000;">1.52</span>  1.59  1.16    <span style="text-decoration: underline;">2</span>361.     13.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> z        0.026<span style="text-decoration: underline;">2</span>  0.002<span style="text-decoration: underline;">69</span> 0.959 0.977 -<span style="color: #BB0000;">1.53</span>  1.58  1.16    <span style="text-decoration: underline;">2</span>279.     14.1</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="visualising-results">Visualising Results<a class="anchor" aria-label="anchor" href="#visualising-results"></a>
</h4>
<p>Ernest provides plotting utilities for evidence, posterior, and
diagnostics.</p>
<div class="section level5">
<h5 id="evidence-evolution">Evidence evolution<a class="anchor" aria-label="anchor" href="#evidence-evolution"></a>
</h5>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">run2</span><span class="op">)</span></span></code></pre></div>
<p><img src="nested-sampling-with-ernest_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="posterior-marginals">Posterior marginals<a class="anchor" aria-label="anchor" href="#posterior-marginals"></a>
</h5>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/visualize.html" class="external-link">visualize</a></span><span class="op">(</span><span class="va">run2</span>, type <span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span></code></pre></div>
<p><img src="nested-sampling-with-ernest_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="trace-plots">Trace plots<a class="anchor" aria-label="anchor" href="#trace-plots"></a>
</h5>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/visualize.html" class="external-link">visualize</a></span><span class="op">(</span><span class="va">run2</span>, type <span class="op">=</span> <span class="st">"trace"</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="nested-sampling-with-ernest_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
</div>
<div class="section level4">
<h4 id="uncertainty-and-resampling">Uncertainty and Resampling<a class="anchor" aria-label="anchor" href="#uncertainty-and-resampling"></a>
</h4>
<p>You can simulate the uncertainty of an NS run by generating random
draws of the log-volume estimate at each iteration (see <span class="citation">Skilling (2006)</span> for the mathematical rationale
of the log-volume estimates). You can further visualise this uncertainty
with the <code>plot</code> method.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calc_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/calculate.html" class="external-link">calculate</a></span><span class="op">(</span><span class="va">run2</span>, ndraws <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">calc_sim</span></span>
<span><span class="co">#&gt; Nested sampling estimates <span style="color: #0000BB;">&lt;ernest_estimate&gt;</span></span></span>
<span><span class="co">#&gt; No. of Simulated Draws: 500</span></span>
<span><span class="co">#&gt; Log. Volume: <span style="color: #0000BB;">-20 ± 1.4</span></span></span>
<span><span class="co">#&gt; Log. Evidence: <span style="color: #0000BB;">-9.1 ± 0.12</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,216 × 4</span></span></span>
<span><span class="co">#&gt;        log_lik        log_volume    log_weight  log_evidence</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  -2650 <span style="color: #949494;">± NA</span>  -0.0019 <span style="color: #949494;">± 0.0019</span>  -2656 <span style="color: #949494;">± 0.78</span>  -2656 <span style="color: #949494;">± 0.78</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  -2278 <span style="color: #949494;">± NA</span>  -0.0039 <span style="color: #949494;">± 0.0026</span>  -2284 <span style="color: #949494;">± 0.81</span>  -2284 <span style="color: #949494;">± 0.81</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  -2233 <span style="color: #949494;">± NA</span>  -0.0059 <span style="color: #949494;">± 0.0034</span>  -2239 <span style="color: #949494;">± 0.83</span>  -2239 <span style="color: #949494;">± 0.83</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  -2013 <span style="color: #949494;">± NA</span>  -0.0079 <span style="color: #949494;">± 0.0039</span>  -2020 <span style="color: #949494;">± 0.76</span>  -2020 <span style="color: #949494;">± 0.76</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  -2008 <span style="color: #949494;">± NA</span>  -0.0098 <span style="color: #949494;">± 0.0044</span>  -2015 <span style="color: #949494;">± 0.74</span>  -2015 <span style="color: #949494;">± 0.73</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  -1968 <span style="color: #949494;">± NA</span>  -0.0118 <span style="color: #949494;">± 0.0047</span>  -1975 <span style="color: #949494;">± 0.78</span>  -1975 <span style="color: #949494;">± 0.78</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  -1927 <span style="color: #949494;">± NA</span>  -0.0138 <span style="color: #949494;">± 0.0052</span>  -1933 <span style="color: #949494;">± 0.84</span>  -1933 <span style="color: #949494;">± 0.84</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  -1905 <span style="color: #949494;">± NA</span>  -0.0158 <span style="color: #949494;">± 0.0056</span>  -1911 <span style="color: #949494;">± 0.84</span>  -1911 <span style="color: #949494;">± 0.84</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  -1871 <span style="color: #949494;">± NA</span>  -0.0179 <span style="color: #949494;">± 0.0060</span>  -1877 <span style="color: #949494;">± 0.76</span>  -1877 <span style="color: #949494;">± 0.76</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  -1832 <span style="color: #949494;">± NA</span>  -0.0199 <span style="color: #949494;">± 0.0063</span>  -1838 <span style="color: #949494;">± 0.77</span>  -1838 <span style="color: #949494;">± 0.77</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,206 more rows</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">calc_sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="nested-sampling-with-ernest_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<hr>
<p>For more details on nested sampling, please refer to ernest’s
documentation or the following references:</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-skilling2006" class="csl-entry">
Skilling, John. 2006. <span>“Nested <span>Sampling</span> for
<span>General</span> <span>Bayesian</span>
<span>Computation</span>.”</span> <em>Bayesian Analysis</em> 1 (4):
833–59. <a href="https://doi.org/10.1214/06-BA127" class="external-link">https://doi.org/10.1214/06-BA127</a>.
</div>
<div id="ref-speagle2020" class="csl-entry">
Speagle, Joshua S. 2020. <span>“<span>DYNESTY</span>: <span>A</span>
<span>Dynamic</span> <span>Nested</span> <span>Sampling</span>
<span>Package</span> for <span>Estimating</span> <span>Bayesian</span>
<span>Posteriors</span> and <span>Evidences</span>.”</span> <em>Monthly
Notices of the Royal Astronomical Society</em> 493 (April): 3132–58. <a href="https://doi.org/10.1093/mnras/staa278" class="external-link">https://doi.org/10.1093/mnras/staa278</a>.
</div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kyle Dewsnap.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
